# üîå WebSocket Server - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ

## üìã –û–±–∑–æ—Ä

WebSocket —Å–µ—Ä–≤–µ—Ä —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏–≥—Ä—ã Aviator –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã (–∏–≥—Ä–æ–∫–∏) –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ –æ–¥–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É –∏ –ø–æ–ª—É—á–∞—é—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã.

---

## üåê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

### –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–§–∞–π–ª:** `res/js/game.js` (—Å—Ç—Ä–æ–∫–∞ ~1520)

```javascript
var socket = io.connect('wss://aviator.valor-games.co/', {
    transports: ['websocket', 'polling'],
    reconnection: true,
    reconnectionDelay: 1000,
    reconnectionAttempts: 10
});
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| URL | `wss://aviator.valor-games.co/` | –ê–¥—Ä–µ—Å WebSocket —Å–µ—Ä–≤–µ—Ä–∞ |
| transports | `['websocket', 'polling']` | –ú–µ—Ç–æ–¥—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (WebSocket –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π) |
| reconnection | `true` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ |
| reconnectionDelay | `1000` | –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º (1 —Å–µ–∫) |
| reconnectionAttempts | `10` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |

---

## üì° –°–æ–±—ã—Ç–∏—è WebSocket

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (connect)

**–ö–æ–≥–¥–∞:** –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```javascript
socket.on('connect', function() {
    console.log('‚úì Connected to WebSocket server!');
});
```

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- ‚úÖ –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞

---

### 2. –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (connect_error)

**–ö–æ–≥–¥–∞:** –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É

```javascript
socket.on('connect_error', function(error) {
    console.error('‚úó WebSocket connection error:', error);
});
```

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É
- ‚úÖ –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- ‚úÖ –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è

---

### 3. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ (disconnect)

**–ö–æ–≥–¥–∞:** –ü–æ—Ç–µ—Ä—è–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º

```javascript
socket.on('disconnect', function() {
    console.log('‚úó Disconnected from WebSocket server');
});
```

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ
- ‚úÖ –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Ç–∞—Ç—É—Å "–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ..."
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

---

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ (coefficient)

**–ö–æ–≥–¥–∞:** –í–æ –≤—Ä–µ–º—è –ø–æ–ª–µ—Ç–∞ —Å–∞–º–æ–ª–µ—Ç–∞ (–∫–∞–∂–¥—ã–µ ~100ms)

```javascript
socket.on('coefficient', function(data) {
    console.log('Coefficient update:', data);
    var $obj = typeof data == "string" ? JSON.parse(data) : data;
    if($obj && $obj.cf && $game.status === 'flight') {
        $game.cur_cf = parseFloat($obj.cf);
    }
});
```

**–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:**
```json
{
    "uid": "all",
    "msg": "coefficient_update",
    "cf": "1.45"
}
```

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç `$game.cur_cf`
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ª–æ–≤–∏—è –∞–≤—Ç–æ–≤—ã–≤–æ–¥–∞

---

### 5. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã (message)

**–ö–æ–≥–¥–∞:** –°–º–µ–Ω–∞ —Ñ–∞–∑—ã –∏–≥—Ä—ã (loading ‚Üí flying ‚Üí finish)

```javascript
socket.on('message', (msg) => { 
    console.log('New message: ', msg);
    var $obj = typeof msg == "string" ? eval('('+ msg +')') : msg;
    
    if($obj && $obj.msg && $obj.msg == "Change game state") {
        var $data = { 
            state: $obj.game.state,
            cf: parseFloat($obj.game.cf).toFixed(2),
            delta: parseInt($obj.game.delta)
        };
        
        switch($data.state) {
            case "loading": 
                $game.finish_to_loading($data); 
                break;
            case "flying": 
                $game.loading_to_flying($data);
                break;
            case "finish": 
                $game.flying_to_finish($data);
                break;
        }
    }
});
```

---

## üéÆ –°–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã

### 1. Loading (–ó–∞–≥—Ä—É–∑–∫–∞)

**–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:**
```json
{
    "uid": "all",
    "msg": "Change game state",
    "game": {
        "id": 1762967026013,
        "state": "loading",
        "cf": 3.47,
        "delta": 5000
    }
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- ‚úÖ –ò–≥—Ä–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ä–µ–∂–∏–º –æ–∂–∏–¥–∞–Ω–∏—è
- ‚úÖ –ò–≥—Ä–æ–∫–∏ –º–æ–≥—É—Ç —Ä–∞–∑–º–µ—â–∞—Ç—å —Å—Ç–∞–≤–∫–∏
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: `delta` –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ (–æ–±—ã—á–Ω–æ 5000ms = 5 —Å–µ–∫)

**–§—É–Ω–∫—Ü–∏—è:** `$game.finish_to_loading($data)`

---

### 2. Flying (–ü–æ–ª–µ—Ç)

**–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:**
```json
{
    "uid": "all",
    "msg": "Change game state",
    "game": {
        "id": 1762967045018,
        "state": "flying",
        "cf": 5.87,
        "delta": 11869
    }
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- ‚úÖ –ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è
- ‚úÖ –°–∞–º–æ–ª–µ—Ç –≤–∑–ª–µ—Ç–∞–µ—Ç
- ‚úÖ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–∞—Å—Ç–µ—Ç
- ‚úÖ –ò–≥—Ä–æ–∫–∏ –º–æ–≥—É—Ç –≤—ã–≤–æ–¥–∏—Ç—å —Å—Ç–∞–≤–∫–∏
- ‚úÖ –°—Ç–∞–≤–∫–∏ –≤—ã—á–∏—Ç–∞—é—Ç—Å—è –∏–∑ –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: `delta` –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ (—Å–ª—É—á–∞–π–Ω–∞—è)

**–§—É–Ω–∫—Ü–∏—è:** `$game.loading_to_flying($data)`

---

### 3. Finish (–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ)

**–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:**
```json
{
    "uid": "all",
    "msg": "Change game state",
    "game": {
        "id": 1762967045018,
        "state": "finish",
        "cf": 5.87,
        "delta": 5000
    }
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- ‚úÖ –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è
- ‚úÖ –°–∞–º–æ–ª–µ—Ç —É–ª–µ—Ç–∞–µ—Ç
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤—ã–∏–≥—Ä—ã—à–∏/–ø—Ä–æ–∏–≥—Ä—ã—à–∏
- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ API
- ‚úÖ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: `delta` –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ (–æ–±—ã—á–Ω–æ 5000ms = 5 —Å–µ–∫)

**–§—É–Ω–∫—Ü–∏—è:** `$game.flying_to_finish($data)`

---

## üîÑ –¶–∏–∫–ª –∏–≥—Ä—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    LOADING (5 —Å–µ–∫)                          ‚îÇ
‚îÇ  - –ò–≥—Ä–æ–∫–∏ —Ä–∞–∑–º–µ—â–∞—é—Ç —Å—Ç–∞–≤–∫–∏                                  ‚îÇ
‚îÇ  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    FLYING (—Å–ª—É—á–∞–π–Ω–æ)                        ‚îÇ
‚îÇ  - –°–∞–º–æ–ª–µ—Ç –≤–∑–ª–µ—Ç–∞–µ—Ç                                         ‚îÇ
‚îÇ  - –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–∞—Å—Ç–µ—Ç (1.00x ‚Üí cf)                         ‚îÇ
‚îÇ  - –ò–≥—Ä–æ–∫–∏ –≤—ã–≤–æ–¥—è—Ç —Å—Ç–∞–≤–∫–∏                                    ‚îÇ
‚îÇ  - –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ ~100ms                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    FINISH (5 —Å–µ–∫)                           ‚îÇ
‚îÇ  - –°–∞–º–æ–ª–µ—Ç —É–ª–µ—Ç–∞–µ—Ç                                          ‚îÇ
‚îÇ  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç                       ‚îÇ
‚îÇ  - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚ñº
                    (–ü–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è)
```

---

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```javascript
var socket = io.connect('http://127.0.0.1:2345', {
    transports: ['websocket', 'polling'],
    reconnection: true,
    reconnectionDelay: 1000,
    reconnectionAttempts: 10
});
```

### –ü—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä

```javascript
var socket = io.connect('wss://aviator.valor-games.co/', {
    transports: ['websocket', 'polling'],
    reconnection: true,
    reconnectionDelay: 1000,
    reconnectionAttempts: 10
});
```

---

## üìä –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

```json
{
    "uid": "all",              // –ü–æ–ª—É—á–∞—Ç–µ–ª—å ("all" = –≤—Å–µ –∫–ª–∏–µ–Ω—Ç—ã)
    "msg": "Change game state", // –¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è
    "game": {                   // –î–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã
        "id": 1762967026013,    // ID —Ä–∞—É–Ω–¥–∞
        "state": "loading",     // –°–æ—Å—Ç–æ—è–Ω–∏–µ (loading/flying/finish)
        "cf": 3.47,             // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
        "delta": 5000           // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ñ–∞–∑—ã (–º—Å)
    }
}
```

### –¢–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| `Change game state` | –°–º–µ–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã |
| `coefficient_update` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ |
| `connection complete` | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |

---

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
console.log('Socket connected:', socket.connected);
console.log('Socket ID:', socket.id);
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π

```javascript
// –î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–¥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
socket.onAny((eventName, ...args) => {
    console.log('Socket event:', eventName, args);
});
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
console.log('Game status:', $game.status);
console.log('Current coefficient:', $game.cur_cf);
console.log('Win coefficient:', $game.win_cf);
```

---

## ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ü–æ—Ç–µ—Ä—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

```javascript
socket.on('disconnect', function() {
    // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    alert('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ. –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...');
    
    // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏ —Å—Ç–∞–≤–æ–∫
    $('.make_bet').attr('disabled', true);
});

socket.on('connect', function() {
    // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏
    $('.make_bet').removeAttr('disabled');
});
```

### –¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```javascript
socket.on('connect_timeout', function() {
    console.error('Connection timeout');
    // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
});
```

---

## üöÄ –ó–∞–ø—É—Å–∫ WebSocket —Å–µ—Ä–≤–µ—Ä–∞

### Node.js —Å–µ—Ä–≤–µ—Ä (–ø—Ä–∏–º–µ—Ä)

**–§–∞–π–ª:** `websocket-server.js`

```javascript
const io = require('socket.io')(2345, {
    cors: {
        origin: "*",
        methods: ["GET", "POST"]
    }
});

let gameState = {
    id: Date.now(),
    state: 'loading',
    cf: 1.0,
    delta: 5000
};

io.on('connection', (socket) => {
    console.log('Client connected:', socket.id);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    socket.emit('message', {
        uid: 'all',
        msg: 'connection complete'
    });
    
    socket.on('disconnect', () => {
        console.log('Client disconnected:', socket.id);
    });
});

// –¶–∏–∫–ª –∏–≥—Ä—ã
function gameLoop() {
    // Loading ‚Üí Flying
    setTimeout(() => {
        gameState.state = 'flying';
        gameState.cf = (Math.random() * 10 + 1).toFixed(2);
        gameState.delta = Math.random() * 20000 + 5000;
        
        io.emit('message', {
            uid: 'all',
            msg: 'Change game state',
            game: gameState
        });
        
        // Flying ‚Üí Finish
        setTimeout(() => {
            gameState.state = 'finish';
            
            io.emit('message', {
                uid: 'all',
                msg: 'Change game state',
                game: gameState
            });
            
            // Finish ‚Üí Loading
            setTimeout(() => {
                gameState.id = Date.now();
                gameState.state = 'loading';
                gameState.delta = 5000;
                
                io.emit('message', {
                    uid: 'all',
                    msg: 'Change game state',
                    game: gameState
                });
                
                gameLoop(); // –ü–æ–≤—Ç–æ—Ä—è–µ–º —Ü–∏–∫–ª
            }, 5000);
        }, gameState.delta);
    }, 5000);
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
gameLoop();

console.log('WebSocket server running on port 2345');
```

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install socket.io

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
node websocket-server.js
```

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ö–ª–∏–µ–Ω—Ç (game.js)

- [x] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket —Å–µ—Ä–≤–µ—Ä—É
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è `connect`
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è `disconnect`
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è `connect_error`
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è `message` (—Å–º–µ–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è)
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è `coefficient` (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞)
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π

### –°–µ—Ä–≤–µ—Ä

- [ ] WebSocket —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–æ–≤
- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏–≥—Ä—ã
- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞
- [ ] –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª (loading ‚Üí flying ‚Üí finish)
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏–π

---

## üéØ –ò—Ç–æ–≥

WebSocket —Å–µ—Ä–≤–µ—Ä –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã –º–µ–∂–¥—É –≤—Å–µ–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ù–∞–¥–µ–∂–Ω–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–≤—è–∑–∏
- ‚úÖ –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è –∏–≥—Ä–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞

**–¢–µ–∫—É—â–∏–π —Å–µ—Ä–≤–µ—Ä:** `wss://aviator.valor-games.co/`

–í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ —ç—Ç–æ–º—É —Å–µ—Ä–≤–µ—Ä—É –∏ –ø–æ–ª—É—á–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã.
